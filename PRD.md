# 📄 PRD: Stored Procedure Result Comparison Framework (Python GUI)

## 1. 개요

### 목적
MS-SQL Server 2022 환경에서 저장 프로시저의 성능 개선 또는 리팩토링 전후 결과를 자동으로 비교하는 Python 기반 **GUI 애플리케이션**을 개발한다.  

GUI를 통해 누구나 손쉽게 테스트 케이스를 구성하고 결과를 시각적으로 검증할 수 있으며, Windows 인증 기반의 안전한 DB 연결과 테스트 케이스의 중앙 저장을 지원한다.

---

## 2. 주요 기능

### 2.1 저장 프로시저 결과 비교

| 항목 | 설명 |
|------|------|
| 결과셋 수 비교 | 원본과 튜닝 프로시저가 반환한 `DataTable` 개수 동일성 확인 |
| 컬럼 구조 비교 | 각 결과셋의 컬럼 수, 이름, 순서, 데이터 타입 비교 |
| 데이터 값 비교 | 각 결과셋의 행 내용 비교 (DeepDiff 사용, 정렬 무시 가능) |
| 다중 결과셋 지원 | `cursor.nextset()`을 통해 순차 비교 |
| 비교 결과 시각화 | GUI에서 비교 결과 PASS/FAIL, 세부 차이 하이라이팅 표시 |
| 결과 저장 | JSON, CSV, HTML로 저장 가능 (선택 사항) |

---

### 2.2 테스트 케이스 관리

| 항목 | 설명 |
|------|------|
| 테스트 케이스 등록 | 프로시저명, 파라미터(JSON) 입력 후 추가 |
| 테스트 케이스 리스트 | GUI 내 리스트로 표시 및 수정/삭제 가능 |
| 다중 테스트 실행 | 등록된 n개의 케이스 순차 실행 |
| DB 저장 연동 | `[추가]` 버튼 클릭 시 자동으로 `TestCase` 테이블에 저장 |
| 유효성 검사 | 파라미터 JSON 형식 자동 검사 및 오류 표시 |
| 중복 방지 (옵션) | 동일 프로시저명 + 파라미터 조합 중복 등록 방지 가능 |

---

### 2.3 파라미터 문자열 자동 변환

#### 목적  
MSSQL 형식의 파라미터 문자열을 GUI에서 JSON으로 자동 변환

#### 입력 예시
@PlantCd=N'1131',@pDate=N'20250508',@pGrpWcCd=N'',@pWcCd=N'',@pWidth=N'1042'

bash
복사
편집

#### 변환 결과
```json
{
  "PlantCd": "1131",
  "pDate": "20250508",
  "pGrpWcCd": "",
  "pWcCd": "",
  "pWidth": "1042"
}
```
처리 방식
정규식 기반 문자열 파싱

N'...' 및 '...' 제거

@key=value → "key": "value" 변환

유효성 오류 시 GUI 메시지 표시

## 3. GUI 구성
### 3.1 로그인 화면
항목	기능
서버명 입력	
DB명 입력	
Windows 인증 체크박스	체크 시 ID/PW 입력란 비활성화
사용자 ID / 비밀번호	SQL 인증일 경우만 입력 가능
연결 테스트 버튼	연결 가능 여부 사전 확인
로그인 버튼	성공 시 메인 화면 진입
오류 메시지 표시	인증 실패 등 사유 명시

### 3.2 메인 화면
테스트 케이스 입력 영역
원본 프로시저명 입력

튜닝 프로시저명 입력

파라미터 입력 텍스트박스 (문자열 또는 JSON 가능)

[변환] 버튼 (문자열 → JSON 자동 변환)

[추가] 버튼 (테스트 케이스 리스트 및 DB 저장)

[삭제] 버튼 (선택한 케이스 삭제)

테스트 케이스 리스트 (선택 시 파라미터 입력창 복원)

실행 제어 및 상태 표시
[테스트 시작] 버튼 (케이스 순차 실행)

[테스트 중단] 버튼

[테스트 결과보기] 버튼

상태 표시줄: 대기, 진행 중, 완료 + 현재 시간

### 3.3 테스트 결과 보기 화면
항목	설명
테스트 케이스 리스트	실행된 케이스 목록
PASS/FAIL 상태 표시	케이스별 비교 결과 요약
결과 출력 그리드 (원본/튜닝)	결과 테이블 2개 또는 탭 형식 (여러 결과셋 지원)
오류 메시지 영역	비교 실패 이유 (예: 컬럼 차이, 값 차이 등)
결과 저장 버튼 (옵션)	JSON / CSV / HTML 저장 선택 가능

## 4. 테스트 케이스 저장 스키마
```sql
CREATE TABLE TestCase (
    id INT PRIMARY KEY IDENTITY,
    proc_name NVARCHAR(200),
    params NVARCHAR(MAX),         -- JSON 형식
    description NVARCHAR(500),
    created_by NVARCHAR(100),
    created_at DATETIME DEFAULT GETDATE()
);
```
## 5. 기술 스택 및 도구
항목	도구
언어	Python 3.10+
GUI 프레임워크	PySide6 (라이선스 문제 해결)
DB 연결	pyodbc (Windows 인증 지원)
비교 도구	pandas, deepdiff
파라미터 변환	정규식 및 JSON 파서
리포트 저장	JSON, CSV, HTML
테스트 케이스 저장	MS-SQL 기반 TestCase 테이블

## 6. 디렉토리 구조 예시
```bash
project_root/
├── gui/                   # GUI 코드 (PySide6)
├── core/                  # 프로시저 실행, 비교 로직
├── models/                # 데이터 모델 (테스트케이스, 결과 등)
├── logs/                  # 비교 실패 결과 저장
├── config/                # DB 설정 파일, env
├── utils/                 # 파라미터 파서 등 유틸
└── main.py                # 실행 진입점
```
## 7. 개발 로드맵
단계	내용
1단계	로그인 화면 + Windows 인증 연결 구현
2단계	메인화면 UI + 테스트 케이스 추가/삭제/입력
3단계	파라미터 문자열 자동 변환기 구현
4단계	저장 프로시저 실행 및 결과 비교 로직 개발
5단계	테스트 결과 보기 화면 구현 및 리포트 저장 기능
6단계	테스트 케이스 DB 저장 연동

## 8. 요구사항 요약
Python 기반 GUI 앱으로 구현

Windows 인증 필수 지원

결과 비교 순서: DataTable 개수 → 컬럼 구조 → 값 비교

테스트 케이스는 n개 가능

케이스는 DB에 저장 (공유 및 재사용 목적)

MSSQL 파라미터 문자열을 JSON으로 자동 변환 지원

GUI를 통해 누구나 사용 가능

